document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".grid-user"),t=document.querySelector(".grid-computer"),n=document.querySelector(".grid-display"),r=document.querySelectorAll(".ship"),s=document.querySelector(".destroyer-container"),i=document.querySelector(".submarine-container"),o=document.querySelector(".cruiser-container"),a=document.querySelector(".battleship-container"),c=document.querySelector(".carrier-container"),l=document.querySelector("#start"),d=document.querySelector("#rotate"),u=document.querySelector("#whose-go"),m=document.querySelector("#info"),y=document.getElementById("setup-buttons"),L=[],h=[];let g=!0,p=!1,f="user";const v=10;let M=0,E=!1,b=!1,k=!1,S=-1;const T=[{name:"destroyer",directions:[[0,1],[0,v]]},{name:"submarine",directions:[[0,1,2],[0,v,20]]},{name:"cruiser",directions:[[0,1,2],[0,v,20]]},{name:"battleship",directions:[[0,1,2,3],[0,v,20,30]]},{name:"carrier",directions:[[0,1,2,3,4],[0,v,20,30,40]]}];function H(e,t){for(let n=0;n<100;n++){const r=document.createElement("div");r.dataset.id=n,e.appendChild(r),t.push(r)}}function q(e){let t=Math.floor(Math.random()*e.directions.length),n=e.directions[t];0===t&&(direction=1),1===t&&(direction=10);let r=Math.abs(Math.floor(Math.random()*h.length-e.directions[0].length*direction));const s=n.some((e=>h[r+e].classList.contains("taken"))),i=n.some((e=>(r+e)%v==9)),o=n.some((e=>(r+e)%v==0));s||i||o?q(e):n.forEach((t=>h[r+t].classList.add("taken",e.name)))}let $,I,Y;function P(){I=this,Y=this.childNodes.length}function C(e){e.preventDefault()}function G(e){e.preventDefault()}function x(){}function D(){let e=I.lastChild.id,t=e.slice(0,-2),r=parseInt(e.substr(-1)),s=r+parseInt(this.dataset.id),i=[0,10,20,30,40,50,60,70,80,90,1,11,21,31,41,51,61,71,81,91,2,22,32,42,52,62,72,82,92,3,13,23,33,43,53,63,73,83,93].splice(0,10*r),o=[99,98,97,96,95,94,93,92,91,90,89,88,87,86,85,84,83,82,81,80,79,78,77,76,75,74,73,72,71,70,69,68,67,66,65,64,63,62,61,60].splice(0,10*r);if(selectedShipIndex=parseInt($.substr(-1)),s-=selectedShipIndex,g&&!i.includes(s))for(let e=0;e<Y;e++){let n;0===e&&(n="start"),e===Y-1&&(n="end"),L[parseInt(this.dataset.id)-selectedShipIndex+e].classList.add("taken","horizontal",n,t)}else{if(g||o.includes(s))return;for(let e=0;e<Y;e++){let n;0===e&&(n="start"),e===Y-1&&(n="end"),L[parseInt(this.dataset.id)-selectedShipIndex+v*e].classList.add("taken","vertical",n,t)}}n.removeChild(I),n.querySelector(".ship")||(k=!0)}function N(){}function O(e){y.style.display="none",p||(E||(e.emit("player-ready"),E=!0,W(M)),b&&("user"===f&&(u.innerHTML="Your Go"),"enemy"===f&&(u.innerHTML="Enemy's Go")))}function W(e){let t=`.p${parseInt(e)+1}`;document.querySelector(`${t} .ready`).classList.toggle("active")}function w(){p||("user"===f&&(u.innerHTML="Your Go",h.forEach((e=>e.addEventListener("click",(function(t){S=e.dataset.id,F(e.classList)}))))),"enemy"===f&&(u.innerHTML="Computers Go",setTimeout(X,1e3)))}H(e,L),H(t,h),"singlePlayer"===gameMode?(q(T[0]),q(T[1]),q(T[2]),q(T[3]),q(T[4]),l.addEventListener("click",(()=>{y.style.display="none",w()}))):function(){const e=io();function t(e){let t=`.p${parseInt(e)+1}`;document.querySelector(`${t} .connected`).classList.toggle("active"),parseInt(e)===M&&(document.querySelector(t).style.fontWeight="bold")}e.on("player-number",(t=>{-1===t?m.innerHTML="Sorry, the server is full":(M=parseInt(t),1===M&&(f="enemy"),console.log(M),e.emit("check-players"))})),e.on("player-connection",(e=>{console.log(`Player number ${e} has connected or disconnected`),t(e)})),e.on("enemy-ready",(t=>{b=!0,W(t),E&&(O(e),y.style.display="none")})),e.on("check-players",(e=>{e.forEach(((e,n)=>{e.connected&&t(n),e.ready&&(W(n),n!==W&&(b=!0))}))})),e.on("timeout",(()=>{m.innerHTML="You have reached the 10 minute limit"})),l.addEventListener("click",(()=>{k?O(e):m.innerHTML="Please place all ships"})),h.forEach((t=>{t.addEventListener("click",(()=>{"user"===f&&E&&b&&(S=t.dataset.id,e.emit("fire",S))}))})),e.on("fire",(t=>{X(t);const n=L[t];e.emit("fire-reply",n.classList),O(e)})),e.on("fire-reply",(t=>{F(t),O(e)}))}(),d.addEventListener("click",(function(){return g?(s.classList.toggle("destroyer-container-vertical"),i.classList.toggle("submarine-container-vertical"),o.classList.toggle("cruiser-container-vertical"),a.classList.toggle("battleship-container-vertical"),c.classList.toggle("carrier-container-vertical"),void(g=!1)):g?void 0:(s.classList.toggle("destroyer-container-vertical"),i.classList.toggle("submarine-container-vertical"),o.classList.toggle("cruiser-container-vertical"),a.classList.toggle("battleship-container-vertical"),c.classList.toggle("carrier-container-vertical"),void(g=!0))})),r.forEach((e=>e.addEventListener("dragstart",P))),L.forEach((e=>e.addEventListener("dragstart",P))),L.forEach((e=>e.addEventListener("dragover",C))),L.forEach((e=>e.addEventListener("dragenter",G))),L.forEach((e=>e.addEventListener("dragleave",x))),L.forEach((e=>e.addEventListener("drop",D))),L.forEach((e=>e.addEventListener("dragend",N))),r.forEach((e=>e.addEventListener("mousedown",(e=>{$=e.target.id}))));let U=0,j=0,z=0,A=0,B=0;function F(e){const n=t.querySelector(`div[data-id='${S}']`),r=Object.values(e);n.classList.contains("boom")||"user"!==f||p||(r.includes("destroyer")&&U++,r.includes("submarine")&&j++,r.includes("cruiser")&&z++,r.includes("battleship")&&A++,r.includes("carrier")&&B++),r.includes("taken")?n.classList.add("boom"):n.classList.add("miss"),Z(),f="enemy","singlePlayer"===gameMode&&w()}let J=0,K=0,Q=0,R=0,V=0;function X(e){if("singlePlayer"===gameMode&&(e=Math.floor(Math.random()*L.length)),L[e].classList.contains("boom"))"singlePlayer"===gameMode&&X();else{const t=L[e].classList.contains("taken");L[e].classList.add(t?"boom":"miss"),L[e].classList.contains("destroyer")&&J++,L[e].classList.contains("submarine")&&K++,L[e].classList.contains("cruiser")&&Q++,L[e].classList.contains("battleship")&&R++,L[e].classList.contains("carrier")&&V++,Z()}f="user",u.innerHTML="Your Go"}function Z(){let e="computer";"multiPlayer"===gameMode&&(e="enemy"),2===U&&(m.innerHTML=`You sunk the ${e}'s destroyer`,U=10),3===j&&(m.innerHTML=`You sunk the ${e}'s submarine`,j=10),3===z&&(m.innerHTML=`You sunk the ${e}'s cruiser`,z=10),4===A&&(m.innerHTML=`You sunk the ${e}'s battleship`,A=10),5===B&&(m.innerHTML=`You sunk the ${e}'s carrier`,B=10),2===J&&(m.innerHTML=`${e} sunk your destroyer`,J=10),3===K&&(m.innerHTML=`${e} sunk your submarine`,K=10),3===Q&&(m.innerHTML=`${e} sunk your cruiser`,Q=10),4===R&&(m.innerHTML=`${e} sunk your battleship`,R=10),5===V&&(m.innerHTML=`${e} sunk your carrier`,V=10),U+j+z+A+B===50&&(m.innerHTML="YOU WIN",_()),J+K+Q+R+V===50&&(m.innerHTML=`${e.toUpperCase()} WINS`,_())}function _(){p=!0,l.removeEventListener("click",w)}}));